openapi: '3.0.2'
info:
  title: API THEye
  version: '0.24.0'
servers:
  - url: https://backend.theye.ch/api/v0
  - url: https://staging.backend.theye.ch/api/v0
  - url: http://localhost:8000/api/v0

components:
  schemas:
    api-version:
      type: object
      properties:
        api_version:
          type: string
          format: semantic version number
          example: '1.2.3'
    signup:
      type: object
      properties:
        signup_token:
          type: string
          format: string
          example: 'fkSF00jawdsf' 
        first_name:
          type: string
          example: Alice
        last_name:
          type: string
          example: Wonderland
        password:
          type: string
          example: SecretPa55word 
    signup-mail:
      type: object
      properties:
        email:
          format:  email
          example: alice.wonderland@mail.com
        client_id:
          type: string
          format: string
          example: 'fkSF00jawdsf' 
    status:
      type: object
      properties:
        code:
          type: string
          example: 400-000
        name:
          type: string
          format: string
          example: STATUS_NAME 
        description:
          type: string
          format: string
          example: Lorem ipsum. 
    status-response:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/status'
    my-client-configuration:
      type: object
      properties:
        version:
          type: string 
          example: '1.2.3'
        configuration:
          type: object
          example: {'custom_property_1': '10', 'custom_property_2':'23'}
    authority-code:
      type: object
      properties:
        key_id:
          type: integer
          example: 314 
        code: 
          type: string 
          format: base16
          maxLength: 16 
          minLength: 16 
          example: 0123456789ABCDEF
    authority-token:
      type: object
      properties:
        device_id:
          type: string 
          format: base16
          maxLength: 12 
          minLength: 12 
          example: 0123456789AB 
          readOnly: true
        token: 
          type: string
          format: base16
          maxLength: 48 
          minLength: 48 
          example: 00112233445566778899AABBCCDDEEFF0123456789ABCDEF
          readOnly: true
    contact:
      type: object
      properties:
        email:
          type: string
          format:  email
          example: alice.wonderland@mail.com
        subject:
          type: string
          maxLength: 255 
          example: Quote request
        body:
          type: string
          maxLength: 5000
          example: Lorem ipsum. 
        first_name:
          type: string
          maxLength: 255 
          example: Alice
        last_name:
          type: string
          maxLength: 255 
          example: Wonderland
        company:
          type: string
          maxLength: 255 
          example: Foo Inc. 
        recaptcha_token: 
          type: string
          maxLength: 255
    checkout-session:
      type: object
      properties:
        price_id:
          type: string
          example: price_fkdalj2o3ijsf
        quantity:
          type: number 
          example: 10 
    checkout-session-url:
      type: object
      properties:
        checkout_url:
          type: string
          example: https://example.com 
    device:
      type: object
      properties:
        id:
          type: string 
          format: base16
          maxLength: 12 
          minLength: 12 
          example: 0123456789AB 
          readOnly: true
        creation_date:
          type: string
          format: iso-8601
          example: 2021-01-18T16:32:10.000000Z
          readOnly: true
        modification_date:
          type: string
          format: iso-8601
          example: 2021-01-18T16:32:10.000000Z
          readOnly: true
        name:
          type: string
          example: Device A
        owner:
          type: integer 
          example: 1 
          readOnly: true
        type:
          type: integer
          example: 10
          readOnly: true
        model:
          type: integer
          example: 11
          readOnly: true
        hardware:
          type: string
          example: 2.3
          readOnly: True
        is_active:
          type: boolean
          example: true
          readOnly: true
        device_info:
          type: object
          readOnly: true
          properties:
            creation_date:
              type: string
              format: iso-8601
              example: 2021-01-18T16:32:10.000000Z
              readOnly: true
            api_version:
              type: string
              format: semantic version number
              example: '1.2.3'
            info:
              type: object
              readOnly: true
              properties:
                info_version:
                  type: integer
                  example: 0
                type:
                  type: integer
                  example: 10
                model:
                  type: integer
                  example: 11
                firmware:
                  type: string
                  example: 1.2
                hardware:
                  type: string
                  example: 2.3
                device_id:
                  type: string 
                  format: base16
                  maxLength: 12 
                  minLength: 12 
                  example: 0123456789AB 
                time_id:
                  type: integer
                  example: "123456"
                local_name:
                  type: string
                  maxLength: 16
                  example: Kitchen
                battery_voltage:
                  type: integer
                  description: Battery voltage in mV [V]
                  example: "3300"
                log_interval:
                  type: object
                  properties:
                    interval:
                      type: integer 
                      description: Interval time in [s]
                      example: 10
                    stop_recording:
                      type: boolean
                      example: false
                    stop_memory_full:
                      type: boolean
                      example: true
                limits:
                  type: object
                  properties:
                    thresholds:
                      type: object
                      properties:
                        lowest_temperature:
                          type: integer
                          description: Temperature in 0.01 [°C] 
                        highest_temperature:
                          type: integer
                          description: Temperature in 0.01 [°C]
                        lowest_humidity:
                          type: integer
                          description: Humidity in 0.01 [%]
                        highest_humidity:
                          type: integer
                          description: Humidity in 0.01 [%]
                    alerts:
                      type: object
                      properties:
                        current_temperature:
                          type: boolean
                        past_temperature:
                          type: boolean
                        past_temperature_resettable:
                          type: boolean
                        current_humidity:
                          type: boolean
                        past_humidity:
                          type: boolean
                        past_humidity_resettable:
                          type: boolean
                    config:
                      type: object
                      properties:
                        hidden:
                          type: boolean
                        tested:
                          type: boolean
    devices:
      type: array
      items:
        type: object
        properties:
          id:
            type: string 
            format: base16
            maxLength: 12 
            minLength: 12 
            example: 0123456789AB 
            readOnly: true
          name:
            type: string
            example: Device A
          owner:
            type: integer 
            example: 1 
            readOnly: true
          type:
            type: integer
            example: 10
            readOnly: true
          model:
            type: integer
            example: 11
            readOnly: true
          hardware:
            type: string
            example: "2.3"
            readOnly: True
          battery_voltage:
            type: integer
            description: Battery voltage in mV [V]
            example: "3300"
          firmware:
            type: string
            example: "1.2"
          organization:
            type: object
            properties:
              id:
                type: integer
                example: 11
                readOnly: true
              name:
                type: string
                example: Company X 
    device-public-info:
      type: object
      properties:
        is_free:
          type: boolean
          example: True
        log:
          type: object
          properties:
            start_time_id:
              type: number 
              example: 3141592 
            head_page_time_id:
              type: number 
              example: 3200000
    devices-summary:
      type: object
      properties:
        total:
          type: integer
          example: 52
        total_owners:
          type: integer
          example: 12 
        total_organizations:
          type: integer
          example: 40 
        owners:
          type: array
          items:
            type: object
            properties:
              id: 
                type: integer
                example : 314 
              total :
                type: integer
                example : 12 
        organizations:
          type: array
          items:
            type: object
            properties:
              id: 
                type: integer
                example : 315 
              total :
                type: integer
                example : 40 
    device-specification:
      type: object
      properties:
        name: 
          type: string
          example: 'TH-2'
          readOnly: true
        description:
          type: string
          example: 'Compact Bluetooth module for secure temperature and humidity recording.'
          readOnly: true
        type:
          type: integer 
          example: 52
          readOnly: true
        model: 
          type: integer
          example: 203
          readOnly: true
        hardware: 
          type: string 
          example: '3.1'
          readOnly: true
        is_active:
          type: boolean 
          example: true
          readOnly: true 
        voltage_low: 
          type: number
          example: 2600.0
          description: Lower voltage in [mV]
          readOnly: true
        voltage_high: 
          type: number
          example: 2900.0
          description: Higher voltage in [mV]
          readOnly: true
        percent_low: 
          type: number
          example: 20.0
          description: Lower value in [%]
          readOnly: true
        percent_high:
          type: number
          example: 80.0
          description: Higher value in [%]
          readOnly: true
        battery_capacity: 
          type: number
          example: 432.0
          description: Battery capacity in [mAh] 
          readOnly: true
        idle_current: 
          type: number
          example: 0.007 
          description: Idle current in [mA] 
          readOnly: true
        measurement_charge:
          type: number
          example: 0.01
          description: Electrical charge of one measurement in [mAs] 
          readOnly: true
        working_range:
          readOnly: true
          type: object
          properties:
            humidity:
              type: object
              properties:
                min:
                  type: number
                  example: 0 
                  description: Humidity min in [%RH] 
                max:
                  type: number
                  example: 100 
                  description: Humidity max in [%Rh] 
            temperature:
              type: object
              properties:
                min:
                  type: number
                  example: -40 
                  description: Temperature min in [°C] 
                max:
                  type: number
                  example: 100 
                  description: Temperature min in [°C] 
        sensor_parameters:
          readOnly: true
          type: object
          properties:
            humidity_accuracy:
              type: object
              properties:
                maximum:
                  type: object
                  properties:
                    humidity: 
                      type: array
                      example: [0, 10, 90, 100]
                      description: Abscissa (RH) in [%Rh] 
                    accuracy: 
                      type: array
                      example: [7.5, 4.5, 4.5, 7.5]
                      description: Ordinate (ΔRH) in [%Rh] 
                typical:
                  type: object
                  properties:
                    humidity: 
                      type: array
                      example: [0, 10,  90, 100] 
                      description: Abscissa (RH) in [%Rh] 
                    accuracy: 
                      type: array
                      example: [4, 2, 2, 4]
                      description: Ordinate (ΔRH) in [%Rh] 
            humidity_drift: 
              type: number
              example: 0.25
              description: Long term humidity drift in [%RH/year]
            temperature_accuracy:
              type: object
              properties:
                maximum:
                  type: object
                  properties:
                    temperature: 
                      type: array
                      example: [-40, 0, 65, 125]
                      description: Abscissa (T) in [°C] 
                    accuracy: 
                      type: array
                      example: [1, 0.4, 0.4, 1]
                      description: Ordinate (ΔT) in [°C] 
                typical:
                  type: object
                  properties:
                    temperature: 
                      type: array
                      example: [-40, 0, 65, 125]
                      description: Abscissa (T) in [%Rh] 
                    accuracy: 
                      type: array
                      example: [0.6, 0.2, 0.2, 0.6]
                      description: Ordinate (ΔT) in [%Rh] 
            tempertature_drift: 
              type: number
              example: 0.03
              description: Long term temperature drift in [°C/year]
    device-specifications:
      type: array
      items:
        $ref: '#/components/schemas/device-specification'
    elog:
      type: object
      properties:
        device_id:
          type: string 
          format: base16
          maxLength: 12 
          minLength: 12 
          example: 0123456789AB 
        edata:
          type: string
          format: base64url 
          example: d3As065hUfzeLue21P69HxIix373+FLWtoMDru6PFdy9ZYLlD6yRuwEJCYAjhATu6LiJp340n7Imhhmmp5Xbm9ws7tKbGyGkxgG7GeJ8fak=
        hash:
          type: string 
          format: base16
          maxLength: 64 
          minLength: 64 
          example: 00112233445566778899AABBCCDDEEFF00112233445566778899AABBCCDDEEFF 
        initialization_vector:
          type: string 
          format: base16
          maxLength: 32 
          minLength: 32 
          example: 00112233445566778899AABBCCDDEEFF 
        key_id:
          type: integer 
          example: 314 
    encrypted_data:
      type: object
      properties:
        device_id:
          type: string 
          format: base16
          maxLength: 12 
          minLength: 12 
          example: 0123456789AB 
        encrypted_data:
          type: string
          format: base64url 
          example: d3As065hUfzeLue21P69HxIix373+FLWtoMDru6PFdy9ZYLlD6yRuwEJCYAjhATu6LiJp340n7Imhhmmp5Xbm9ws7tKbGyGkxgG7GeJ8fak=
        hash:
          type: string 
          format: base16
          maxLength: 64 
          minLength: 64 
          example: 00112233445566778899AABBCCDDEEFF00112233445566778899AABBCCDDEEFF 
        initialization_vector:
          type: string 
          format: base16
          maxLength: 32 
          minLength: 32 
          example: 00112233445566778899AABBCCDDEEFF 
        key_id:
          type: integer 
          example: 314 
    feature:
      type: object
      properties:
        max_devices:
          type: integer 
        max_organizations:
          type: integer 
        max_members:
          type: integer 
        data_history_seconds:
          type: string 
        chart_superposition:
          type: boolean 
        email_new_data:
          type: boolean 
        alarm_system:
          type: boolean 
        data_export:
          type: boolean 
        signed_certificate:
          type: boolean 
        locking: 
          type: boolean 
    log:
      type: object
      properties:
        device_id:
          type: string
          format: hex48 
          example: 0123456789AB 
        time:
          type: array
          items: 
            type: integer
            description: Time in POSIX 
          example:
            - 10
            - 20 
            - 30 
        temperature:
          type: array
          items: 
            type: integer
            description: Temperature of the point (in 0.01 [°C]) 
          example:
            - 2500 
            - 2510 
            - 2490 
        humidity:
          type: array
          items: 
            type: integer
            description: Humidity of the point (in 0.01 [%]) 
          example:
            - 5000 
            - 5010 
            - 4990 
    ownership-code:
      type: object
      properties:
        code: 
          type: string 
          format: base16
          maxLength: 32 
          minLength: 32 
          example: 00112233445566778899AABBCCDDEEFF 
          readOnly: true
        expires:
          type: string
          format: iso-8601
          example: 2021-01-18T16:32:10.000000Z
          readOnly: true
    ownership-factory-code:
      type: object
      properties:
        device_id: 
          type: string 
          format: base16
          example: 0123456789AB
          readOnly: true
        code: 
          type: string 
          format: base16
          example: CDEF1011 
          readOnly: true
        salt_id:
          type: integer 
          example: 0
          readOnly: true
      description: 
        'Data are encoded in big endian in QRCode.
        Example: device_code=0123456789AB and code=CDEF1011 become 
        AB89674523011110EFCD (AB:89:67:45:23:01 11:10:EF:CD) in QRCode.'

    ownership-token:
      type: object
      properties:
        key_id: 
          type: integer
          example: 314 
        ownership_token:
          type: string
          format: base16
          maxLength: 32 
          minLength: 32 
          example: 00112233445566778899AABBCCDDEEFF
        ownership_factory_code:
          type: string
          format: base16
          maxLength: 8 
          minLength: 8 
          example: ABCDEF01
    password:
      type: object
      properties:
        password:
          type: string
          example: SecretPa55word 
        new_password:
          type: string
          example: NewSecretPa55word 
    plan:
      type: object
      properties:
        stripe_id:
          type: string 
          example: prod_loremipsum 
          readOnly: True
        name:
          type: string
          example: Pro 
        description:
          type: string
          example: Pro plan 
        display_order:
          type: integer 
          example: 10 
        features:
          type: object 
          $ref : '#/components/schemas/feature'
        prices:
          type: array
          items:
            type: object 
            $ref : '#/components/schemas/price'
    portal-session-url:
      type: object
      properties:
        portal_url:
          type: string
          example: https://example.com 
    price:
      type: object
      properties:
        stripe_id:
          type: string 
          example: price_loremipsum 
          readOnly: True
        currency:
          type: string
          example: chf 
        interval:
          type: string
          example: month 
        interval_count:
          type: integer 
          example: 1 
        unit_amount:
          type: integer 
          example: 1 
    product:
      type: object
      properties:
        stripe_id:
          type: string 
          example: prod_loremipsum 
          readOnly: True
        name:
          type: string
          example: Pro 
        description:
          type: string
          example: Pro plan 
        display_order:
          type: integer 
          example: 10 
        features:
          type: object 
          $ref : '#/components/schemas/feature'
    subscription:
      type: object
      properties:
        stripe_id:
          type: string 
          example: prod_loremipsum 
          readOnly: True
        quantity:
          type: string 
          example: prod_loremipsum 
          readOnly: True
        price:
          type: object 
          $ref : '#/components/schemas/price'
        product:
          type: object 
          $ref : '#/components/schemas/product'
    profile:
      type: object
      properties:
        id:
          type: integer
          example: 314
          readOnly: True
        email:
          type: string
          format:  email
          example: alice.wonderland@mail.com
        first_name:
          type: string
          example: Alice
        last_name:
          type: string
          example: Wonderland
        unicode_locale_id:
          type: string
          format: unicode locale identifier
          description: https://unicode.org/reports/tr35/
          example: 'en-US'

    synchronization-nonce:
      type: object
      properties:
        nonce:
          type: string 
          format: base16
          maxLength: 24 
          minLength: 24 
          example: 00112233445566778899AABB
          readOnly: true
        expires:
          type: string
          format: iso-8601
          example: 2021-01-18T16:32:10.000000Z
          readOnly: true
    synchronization-code:
      type: object
      properties:
        device_id:
          type: string 
          format: base16
          maxLength: 12 
          minLength: 12 
          example: 0123456789AB 
        key_id:
          type: integer
          example: 314 
        synchronization_code: 
          type: string 
          format: base16 
          maxLength: 32 
          minLength: 32 
          example: 00112233445566778899AABBCCDDEEFF
    synchronization-token:
      type: object
      properties:
        device_id:
          type: string 
          format: base16
          maxLength: 12 
          minLength: 12 
          example: 0123456789AB 
          readOnly: true
        synchronization_token: 
          type: string
          format: base16 
          maxLength: 48 
          minLength: 48 
          example: 00112233445566778899AABBCCDDEEFF0123456789ABCDEF
          readOnly: true

  securitySchemes:
    theye_oauth:
      type: oauth2
      flows:
        authorizationCode:
          authorizationUrl: 'https://backend.theye.ch/o/authorize'
          tokenUrl: 'https://backend.theye.ch/o/token'
          scopes:
            'openid': OpenId Connect scope
            'read': Can read 
            'write': Can write 
    theye_oidc:
      type: openIdConnect
      openIdConnectUrl: 'https://backend.theye.ch/o/.well-known/openid-configuration'

paths:
  /:
    get:
      description: Get THEye API version. 
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/api-version'
  /contact/:
    post:
      description: Post a contact formular. 
      requestBody:
        description: Contact 
        required: true
        content:
          application/json:
            schema:
              $ref : '#/components/schemas/contact' 
      responses:
        '202':
          description: OK
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response'
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '500':
          description: Internal server error. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /devices/:
    get:
      description: Get all devices of the user.
      parameters:
        - name: owner 
          in : query
          description: Filter by device owner.
          schema:
            type: array
            items:
              type: integer
              example: 314
        - name: organization 
          in : query
          description: Filter by organization.
          schema:
            type: array
            items:
              type: integer
              example: 314
      security:
        - theye_oauth:
          - read 
      responses:
        '200': 
          description: OK
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/devices' 
        '401':
          description: Unauthorized.
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /devices/summary/:
    get:
      description: Get devices summary.
      parameters:
        - name: owner 
          in : query
          description: Filter by device owner.
          schema:
            type: array
            items:
              type: integer
              example: 314
        - name: organization 
          in : query
          description: Filter by organization.
          schema:
            type: array
            items:
              type: integer
              example: 314
      security:
        - theye_oauth:
          - read 
      responses:
        '200': 
          description: OK
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/devices-summary'
                  
        '401':
          description: Unauthorized.
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /devices/{device-id}/:
    get:
      description: Get device.
      parameters:
        - name: device-id
          in: path
          required: true
          schema:
            type: string 
            format: base16
            maxLength: 12 
            minLength: 12 
            example: 0123456789AB 
      security:
        - theye_oauth:
          - read 
      responses:
        '200': 
          description: OK
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/device' 
        '401':
          description: Unauthorized. 
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '404':
          description: Not found. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
    put:
      description: Put device.
      parameters:
        - name: device-id
          in: path
          required: true
          schema:
            type: string 
            format: base16
            maxLength: 12 
            minLength: 12 
            example: 0123456789AB 
      requestBody:
        description: Data of the device to update
        required: true
        content:
          application/json:
            schema:
              $ref : '#/components/schemas/device' 
      security:
        - theye_oauth:
          - write 
      responses:
        '200': 
          description: Ok, device updated 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/device' 
        '401':
          description: Unauthorized. 
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '404':
          description: Not found. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /devices/{device-id}/compute-access-token:
    put:
      description: Compute and get the access token.
      parameters:
        - name: device-id
          in: path
          required: true
          schema:
            type: string 
            format: base16
            maxLength: 12 
            minLength: 12 
            example: 0123456789AB 
      security:
        - theye_oauth:
          - write 
      requestBody:
        description: Code 
        required: true
        content:
          application/json:
            schema:
              $ref : '#/components/schemas/authority-code' 
      responses:
        '200': 
          description: Ok, access-token delivered.  
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/authority-token' 
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '401':
          description: Unauthorized. 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '404':
          description: Not found. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '500':
          description: Internal server error. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /devices/{device-id}/compute-configuration-token:
    put:
      description: Compute and get the configuration token.
      parameters:
        - name: device-id
          in: path
          required: true
          schema:
            type: string 
            format: base16
            maxLength: 12 
            minLength: 12 
            example: 0123456789AB 
      security:
        - theye_oauth:
          - write 
      requestBody:
        description: Code 
        required: true
        content:
          application/json:
            schema:
              $ref : '#/components/schemas/authority-code' 
      responses:
        '200': 
          description: Ok, configuration-token delivered.  
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/authority-token' 
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '401':
          description: Unauthorized. 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '404':
          description: Not found. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '500':
          description: Internal server error. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 

  /devices/{device-id}/compute-factory-access-token:
    put:
      description: Compute and get the factory access token.
      parameters:
        - name: device-id
          in: path
          required: true
          schema:
            type: string 
            format: base16
            maxLength: 12 
            minLength: 12 
            example: 0123456789AB 
      requestBody:
        description: Code 
        required: true
        content:
          application/json:
            schema:
              $ref : '#/components/schemas/authority-code' 
      responses:
        '200': 
          description: Ok, factory-access-token delivered.  
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/authority-token' 
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '404':
          description: Not found. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '500':
          description: Internal server error. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /devices/{device-id}/compute-factory-configuration-token:
    put:
      description: Compute and get the factory access token.
      parameters:
        - name: device-id
          in: path
          required: true
          schema:
            type: string 
            format: base16
            maxLength: 12 
            minLength: 12 
            example: 0123456789AB 
      requestBody:
        description: Code 
        required: true
        content:
          application/json:
            schema:
              $ref : '#/components/schemas/authority-code' 
      responses:
        '200': 
          description: Ok, factory-configuration-token delivered.  
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/authority-token' 
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '404':
          description: Not found. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '500':
          description: Internal server error. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 

  /devices/{device-id}/compute-lock-token:
    put:
      description: Compute and get the device lock token.
      parameters:
        - name: device-id
          in: path
          required: true
          schema:
            type: string 
            format: base16
            maxLength: 12 
            minLength: 12 
            example: 0123456789AB 
      requestBody:
        description: Lock Code 
        required: true
        content:
          application/json:
            schema:
              $ref : '#/components/schemas/authority-code' 
      security:
        - theye_oauth:
          - read 
      responses:
        '200': 
          description: Ok, lock-token delivered.  
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/authority-token' 
        '401':
          description: Unauthorized. 
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '404':
          description: Not found. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '500':
          description: Internal server error. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /devices/{device-id}/log/:
    get:
      description: Get log of the device
      security:
        - theye_oauth:
          - read 
      parameters:
        - name: device-id
          in: path
          required: true
          schema:
            type: string 
            format: base16
            maxLength: 12 
            minLength: 12 
            example: 0123456789AB 
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/log'
        '401':
          description: Unauthorized. 
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '404':
          description: Not found. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '500':
          description: Internal server error. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /devices/{device-id}/own:
     put:
      description: Own the device.
      parameters:
        - name: device-id
          in: path
          required: true
          schema:
            type: string 
            format: base16
            maxLength: 12 
            minLength: 12 
            example: 0123456789AB 
      requestBody:
        description: Owneship token 
        required: true
        content:
          application/json:
            schema:
              $ref : '#/components/schemas/ownership-token' 
      security:
        - theye_oauth:
          - write 
      responses:
        '200': 
          description: Ok, ownership granted. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '201': 
          description: Ok, ownership granted and device created. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '401':
          description: Unauthorized. 
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '404':
          description: Not found. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '500':
          description: Internal server error. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /devices/{device-id}/ownership-factory-code/:
    get:
      description: Get the ownership factory code of the device
      security:
        - theye_oauth:
          - read 
      parameters:
        - name: device-id
          in: path
          required: true
          schema:
            type: string 
            format: base16
            maxLength: 12 
            minLength: 12 
            example: 0123456789AB 
          
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/ownership-factory-code'
        '401':
          description: Unauthorized. 
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '404':
          description: Not found. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '500':
          description: Internal server error. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /devices/{device-id}/release:
     put:
      description: Release ownership of the device.
      parameters:
        - name: device-id
          in: path
          required: true
          schema:
            type: string 
            format: base16
            maxLength: 12 
            minLength: 12 
            example: 0123456789AB 
      security:
        - theye_oauth:
          - write 
      responses:
        '200': 
          description: Ok, ownership released. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '401':
          description: Unauthorized. 
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '404':
          description: Not found. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '500':
          description: Internal server error. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /devices/{device-id}/public-info/:
     get:
      description: Get public info about the device.
      parameters:
        - name: device-id
          in: path
          required: true
          schema:
            type: string 
            format: base16
            maxLength: 12 
            minLength: 12 
            example: 0123456789AB 
      responses:
        '200': 
          description: Ok. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/device-public-info' 
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '404':
          description: Not found. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /device-info/:
    post:
      description: Post encrypted device info. 
      requestBody:
        description: Encrypted device info 
        required: true
        content:
          application/json:
            schema:
              $ref : '#/components/schemas/encrypted_data' 
      responses:
        '201':
          description: Created 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '404':
          description: Not found. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '409':
          description: Conflict.
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '500':
          description: Internal server error. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /discovery/device-specifications/:
    get:
      description: Get device specification list. 
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/device-specifications'
  /my-client-configuration/:
    get: 
      description: Get the client configuration of the current user and the current application. 
      security:
        - theye_oauth:
          - read 
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/my-client-configuration' 
        '401':
          description: Unauthorized.
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '404':
          description: Not found. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '500':
          description: Internal server error. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
    put: 
      description: Create or update the client configuration of the current user and the current application. 
      security:
        - theye_oauth:
          - write 
      requestBody:
        description: Configuration data 
        required: true
        content:
          application/json:
            schema:
              $ref : '#/components/schemas/my-client-configuration' 
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/my-client-configuration' 
        '201':
          description: OK
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/my-client-configuration' 
        '401':
          description: Unauthorized.
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 

  /elog/:
    put:
      description: Put encrypted log
      requestBody:
        description: Encrypted data 
        required: true
        content:
          application/json:
            schema:
              $ref : '#/components/schemas/elog' 
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '404':
          description: Not found. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '500':
          description: Internal server error. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /ownership-code/: 
    post:
      description: Create and get an ownership code. 
      security:
        - theye_oauth:
          - write 
      responses:
        '201': 
          description: Ok, ownership code created. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/ownership-code' 
        '401':
          description: Unauthorized.
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /profile/:
    get:
      description: Get user profile.
      security:
        - theye_oauth:
          - read 
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/profile' 
        '401':
          description: Unauthorized 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
    put:
      description: Update the user profile.
      security:
        - theye_oauth:
          - write 
      requestBody:
        description: Data of the profile to update
        required: true
        content:
          application/json:
            schema:
              $ref : '#/components/schemas/profile' 
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/profile' 
        '401':
          description: Unauthorized 
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 

  /profile/password/:
    put:
      description: Update the user password. 
      security:
        - theye_oauth:
          - write
      requestBody:
        description: Passwords 
        required: true
        content:
          application/json:
            schema:
              $ref : '#/components/schemas/password' 
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '401':
          description: Unauthorized 
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /signup/:
    post:
      description: Signup  
      requestBody:
        description: User informations 
        required: true
        content:
          application/json:
            schema:
              $ref : '#/components/schemas/signup' 
      responses:
        '201':
          description: Created. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '404':
          description: Not found. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '500':
          description: Internal server error. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /signup/email/:
    post:
      description: Send a verification link to the given email address. 
      requestBody:
        description: Email and client id 
        required: true
        content:
          application/json:
            schema:
              $ref : '#/components/schemas/signup-mail' 
      responses:
        '202':
          description: Signup send email accepted. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '404':
          description: Not found. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '500':
          description: Internal server error. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /subscription/checkout-session/:
    post:
      description: Create a Stripe checkout session 
      security:
        - theye_oauth:
          - write 
      requestBody:
        description:  Product and quantity 
        required: true
        content:
          application/json:
            schema:
              $ref : '#/components/schemas/checkout-session' 
      responses:
        '201':
          description: Created. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/checkout-session-url' 
        '401':
          description: Unauthorized. 
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '500':
          description: Internal server error. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /subscription/portal-session/:
    post:
      description: Create a Stripe portal session 
      security:
        - theye_oauth:
          - write 
      responses:
        '201':
          description: Created. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/portal-session-url' 
        '401':
          description: Unauthorized. 
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '500':
          description: Internal server error. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /subscription/my-subscription/:
    get:
      description: Get the user current stripe subscription 
      security:
        - theye_oauth:
          - write 
      responses:
        '200':
          description: OK. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/subscription' 
        '401':
          description: Unauthorized. 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '500':
          description: Internal server error. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
  /subscription/plans/:
    get:
      description: Get stripe plans (product and prices) 
      responses:
        '200':
          description: OK. 
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref : '#/components/schemas/plan' 
  /synchronization-nonce/:
    post:
      description: Get server nonce for server-device time synchronization. 
      responses:
        '201':
          description: Created. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/synchronization-nonce' 

  /synchronization-points/:
     post:
      description:  Create a server-device time synchronization point. 
      parameters:
        - name: device-id
          in: path
          required: true
          schema:
            type: string 
            format: base16 
            maxLength: 12 
            minLength: 12 
            example: 0123456789AB 
      requestBody:
        description: Synchronization code 
        required: true
        content:
          application/json:
            schema:
              $ref : '#/components/schemas/synchronization-code' 
      responses:
        '201':
          description: Created 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/synchronization-token' 
        '400':
          description: Bad request. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '403':
          description: Forbidden. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '404':
          description: Not found. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '409':
          description: Conflict.
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 
        '500':
          description: Internal server error. 
          content:
            application/json:
              schema:
                $ref : '#/components/schemas/status-response' 